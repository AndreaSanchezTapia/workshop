# Implementação

## Configurações geofísicas 

<!-- Alisson: este nome pode mudar -->

## Resiliência da Paisagem
A Resiliência da Paisagem foi calculada como a média entre os valores padronizados de [__diversidade da paisagem__](#diversidade-da-paisagem) e [__diversidade da paisagem__](#conectividade-local-1). Todas as imagens estavam na escala de 90 metros e reprojetadas para o DATUM WGS84

### Diversidade da paisagem

O cálculo de diversidade da paisagem foi realizado no Google Earth Engine [@gorelick_google_2017] e é composto por médias feitas pixel a pixel entre os maiores valores padronizados (_Z-scores_) das imagens: [__diversidade de formas de relevo__](#formas-de-relevo), [__amplitude altitudinal__](#amplitude-altitudinal), [__densidade de banhados__](#densidade-de-banhados) e [__diversidade de Solo__](#diversidade-de-solo). 
Utilizamos o Google Earth Engine por ser uma plataforma baseada em nuvem  que oferece acesso remoto a uma vasta coleção de imagens de satélite e bases de dados geoespaciais de acesso livre e com capacidade computacional para realizar as análises em qualquer equipamento disponivel (citação). Isso possibilita com que nossas análises sejam de livre acesso e que contribua para uma ciência mais transparente e livre (citação).

#### Formas de Relevo
<!--1- Calculate relief slopes, aspects and Topographic Position Index (TPI) from a Digital Elevation Model.-->

<!--2- Calculate a moisture index from a flow accumulation raster and slopes.-->

<!--3- Transform slopes, aspect, TPI and moisture index into classes-->

<!--4- Combine slopes, aspect, TPI and moisture classes into a code string-->

<!--5- Re-classify landform string into landform types-->

<!--6- Count the number of distinct landforms within a focal cell kernel (landform variety)-->

<!--7- Calculate the Z-scores for global and whithin geophysical -->
#### Amplitude Altitudinal
<!--1- Calculate elevation range within a neighborhood-->

<!--2- Run a regression between elevation range and elevation-->

<!--3- Calculate regression residuals-->

<!--4- Calculate the Z-scores for global and whithin geophysical -->
#### Densidade de Banhados
<!--1- Import wetland raster; -->
Para calcular a densidade de banhados usados os dados disponibilizados na base de dados _Global Wetlands Database_ (citação), que é uma base de dados que fornece informação e inventário de áreas de zonas úmidas no mundo. Os dados são obtidos através de imagens de satélite, amostragens aéreas e relatórios publicados. Como áreas de banhados ocorrem em diversas configurações e distribuição no espaço, calculamos a densidade em escala local, escala regional e a  
<!--2- filter rivers and lake out; -->

<!--3- Count the number of wetlands within a circular kernel with 1170 meters radius; -->

<!--4- Divide the number of wetlands by the number of cells within the kernel.-->

#### Diversidade de Solo
<!--1- Import soil data-->

<!--2- Filter soil codes-->

<!--3- Calculate a raster of soil type presence within a neighborhood-->

<!--4- Sum the soil presence rasters to create a raster of soil diversity within the neighborhood-->

<!--5- Calculate the Z-scores for global and whithin geophysical -->

### Conectividade local

Residuos da regressão da diversidade da paisagem em função do clima. 


#### Cálculos de resistência

Os valores de resitência são medidas relativas do grau de dificuldade de deslocamento dos organismos nos diferentes tipos de cobertura do solo. Essas medidas foram atribuídos por bioma, seguindo a premissa é que quanto maior for a diferença estrutural entre um dado tipo de cobertura do solo e a vegetação original do bioma, maior será o valor de resistência da classe de cobertura do solo em questão.

Os dados espaciais primários utilizados para calcular a superfície de resistência até o momento foram a camada de cobertura do solo fornecida pelo MapBiomas (coleção 7, ano 2021) e a base de estradas fornecida pelo IBGE (BCIM250, ano 2021). Para tanto, preliminarmente, a superfície de cobertura do solo do MapBiomas foi reamostrada para geral pixels com 90 metros de tamanho, aproximadamente. Também foi necessário converter o arquivo vetorial de estradas para o formato matricial, com pixels de tamanho aproximado de 90 metros.  
<!-- Falta completar -->


#### Filtro de kernel como _proxy_ da conectividade local

Um filtro de _kernel_ de 23 x 23 píxeis (~2070m) foi aplicado ao raster de resistências. 


### Combinando diversidade da paisagem e conectividade local: resiliência

## Conectividade regional

O cálculo da conectividade regional, baseada em teoria de circuitos [@mcrae_isolation_2006] foi realizado utilizando a implementação de Omniscape para Julia [@hall_circuitscape_2021; @landau_omniscapejl_2021]. 


Foram utilisados: 

+ o raster de resistência, com filtro de _kernel_ utilizado como base para a conectividade local, subamostrado para uma resolução de 900m por pixel,
+ um raio da área de interesse de 100 píxeis (~90km)
+ agrupamentos de 5 píxeis de interesse para a janela móvel (~4.5km).

O output de Omniscape são três arquivos de conectividade relacionados: 

+ `flow_current` é o fluxo que aconteceria sem levar em conta a camada de resistência. Ele leva em conta a configuração espacial da paisagem (estreitos, barras) e dos píxeis de baixa resistência de origem. Nem todo pixel é source pixel, mas a corrente que entra em cada pixel de baixa resistência entra sem resistência. Flow current é usado como um "modelo nulo" de conectividade. 
+ `cumulative_current` é a corrente levando em conta a configuração espacial e os valores de resistência
+ `normalized_current` equivale a $\frac{cumulative\_current}{flow\_current}$
e controla o efeito da configuração espacial do cálculo de conectividade.

Os resultados da análise nesta escala espacial foram reclassificados de acordo com a distribuição ao redor da média dos valores nas categorias seguintes:

+ Entre o valor mínimo e média - 0,5 desvio padrão: fluxo impedido. O fluxo não consegue circular devido à presença de áreas de alta resistência, podendo se redirecionar em torno a essas áreas
+ Entre média - 0,5 desvio padrão e média + 1 desvio padrão: fluxo difuso. O fluxo consegue se dispersar em áreas contíguas de resistências baixas a moderadas, sem se ver impedido ou canalizado 
+ Entre média + 1 desvio padrão e média + 2 desvios padrão: fluxo intensificado. O fluxo potencial se concentra devido à configuração da paisagem ou de áreas de alta resistência que forçam um rumo determinado
+ Maior que a média + 2 desvios padrão: fluxo canalizado. Fluxo muito acima do esperado em uma área sem resistência. Ele passa por estreitos, barras de areia e estruturas similares. 

