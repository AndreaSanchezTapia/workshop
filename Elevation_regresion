var cerrado = ee.FeatureCollection("users/lucasljardim9/wwf_cerrado");

var dataset = ee.Image("MERIT/DEM/v1_0_3").clip(cerrado);

var neighbor = dataset.neighborhoodToBands(ee.Kernel.square(1));

var elevation_max = neighbor.reduce(ee.Reducer.max());

var elevation_min = neighbor.reduce(ee.Reducer.min());

var elevation_range = elevation_max.subtract(elevation_min).abs();

var elevation = ee.Image.cat(dataset, elevation_range)
                 .rename(['elevation', 'elevation_range']);
                 
var regression = elevation.reduceRegion({
     reducer: ee.Reducer.linearFit(),
     geometry: cerrado,
     maxPixels: 463690740
    });
    
var pred = elevation.select('elevation').multiply(ee.Number(regression.get('scale')));

var predict = pred.add(ee.Number(regression.get('offset')));

var residuals = elevation.select('elevation').subtract(predict).rename(['residuals']);

var sample = ee.FeatureCollection.randomPoints({
               region: cerrado,
               points: 1000
             });
             
var residual_samp = residuals.sampleRegions({collection: sample});

var elevation_samp = elevation.select('elevation').sampleRegions({collection: sample})



print(residual_samp)

/*
var y = residual_samp.reduceRegion(
    {reducer: ee.Reducer.toList(), 
     geometry: cerrado
     })
    .get('residuals');
    
var x = elevation_samp.reduceRegion(
    {reducer: ee.Reducer.toList(), 
     geometry: cerrado
    })
    .get('elevation');
    
var chart = ui.Chart.array.values({array: y, axis: 0, xLabels: x});
print(chart);
*/                        

Map.setCenter(-50, -15, 7);

//Map.addLayer();



