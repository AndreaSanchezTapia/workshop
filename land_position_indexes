var cerrado = ee.FeatureCollection("users/lucasljardim9/wwf_cerrado");

var dataset = ee.Image("MERIT/DEM/v1_0_3").clip(cerrado);

// Split neighbor cells within a kernel of 1 pixel in bands

var neigh = dataset.neighborhoodToBands(ee.Kernel.square(1));

// Calculate a mean difference weighted by the distance (Land position Index(LPI))
/*
 It is calculated by subtracting each neighbor cell by the focal cell, 
   dividing them by their distances and calculating their average
*/

/* We must calculate multiple window size and take the average value*/

var LPI = neigh.subtract(dataset).divide(90).reduce(ee.Reducer.mean());

var MTPI = ee.Image("CSP/ERGo/1_0/Global/ALOS_mTPI").clip(cerrado);

var land_position = ee.Image([LPI, MTPI])
     .rename(["LPI", "MTPI"]);
     
var sample_points = land_position
                     .sample({region:cerrado, numPixels:2000});
                 
var correlation = sample_points.reduceColumns(ee.Reducer.pearsonsCorrelation(), ["LPI", "MTPI"]);

print(correlation);
  
//Scatterplot

var chart = ui.Chart.feature.byFeature(sample_points, 'LPI', ['MTPI'])
  .setChartType('ScatterChart');
  
  print(chart);
  
 
/*

Map.setCenter(-50, -15, 7);
Map.addLayer(MTPI);


*/